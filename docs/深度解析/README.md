# ECE 391 MP3 深度解析文档

本文档集按 Checkpoint 顺序组织，覆盖 MP3 操作系统的所有核心模块。

## 文档总览

### Checkpoint 1 - 基础设施

| 编号 | 文档 | 内容 |
|------|------|------|
| 01 | [IDT-深度解析](01-IDT-深度解析.md) | 中断描述符表、中断门/陷阱门、DPL |
| 02 | [分页系统-深度解析](02-分页系统-深度解析.md) | 页目录、页表、地址转换、CR寄存器 |
| 03 | [异常处理-深度解析](03-异常处理-深度解析.md) | 汇编包装、栈变化、pushal/iret |
| 04 | [GCC内联汇编-深度解析](04-GCC内联汇编-深度解析.md) | 内联汇编语法、约束、clobbers |

### Checkpoint 2 - 设备驱动与文件系统

| 编号 | 文档 | 内容 |
|------|------|------|
| 05 | [键盘驱动-深度解析](05-键盘驱动-深度解析.md) | PS/2 键盘、扫描码、中断处理 |
| 06 | [终端驱动-深度解析](06-终端驱动-深度解析.md) | 终端读写、显存操作、光标控制 |
| 07 | [RTC驱动-深度解析](07-RTC驱动-深度解析.md) | RTC 硬件、频率设置、虚拟化 |
| 08 | [文件系统-深度解析](08-文件系统-深度解析.md) | 只读文件系统、inode、dentry |

### Checkpoint 3 - 系统调用与进程

| 编号 | 文档 | 内容 |
|------|------|------|
| 09 | [系统调用-深度解析](09-系统调用-深度解析.md) | int 0x80、系统调用表、文件描述符、op_table |
| 10 | [进程管理-深度解析](10-进程管理-深度解析.md) | PCB、execute、halt、进程内存布局 |
| 11 | [进程调度-深度解析](11-进程调度-深度解析.md) | 上下文切换、TSS、内核栈 |

### Checkpoint 4 - 多终端

| 编号 | 文档 | 内容 |
|------|------|------|
| 12 | [多终端-深度解析](12-多终端-深度解析.md) | Alt+Fx 切换、视频备份、键盘隔离 |

### Checkpoint 5 - 调度器

| 编号 | 文档 | 内容 |
|------|------|------|
| 13 | [PIT与调度-深度解析](13-PIT与调度-深度解析.md) | PIT 定时器、Round-Robin、schedule() |

## 学习路径

```
Checkpoint 1 (基础)
    │
    ├── IDT ──────────→ 理解中断入口
    │
    ├── 分页 ─────────→ 理解内存隔离
    │
    └── 异常处理 ────→ 理解栈切换
            │
            ▼
Checkpoint 2 (驱动)
    │
    ├── 键盘 + 终端 ──→ 理解 I/O
    │
    ├── RTC ─────────→ 理解定时器
    │
    └── 文件系统 ────→ 理解数据存储
            │
            ▼
Checkpoint 3 (进程)
    │
    ├── 系统调用 ────→ 用户态-内核态接口
    │
    ├── 进程管理 ────→ execute/halt
    │
    └── 进程调度 ────→ 上下文切换基础
            │
            ▼
Checkpoint 4 (多终端)
    │
    └── 多终端 ─────→ 显示与输入隔离
            │
            ▼
Checkpoint 5 (调度)
    │
    └── PIT + 调度 ──→ 时间片轮转
```

## 核心概念关联

```
                    ┌─────────────┐
                    │    IDT      │
                    │  (中断入口)  │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  异常处理     │  │  设备中断     │  │  系统调用     │
│  (除零、页错误) │  │  (键盘、RTC)  │  │  (int 0x80)  │
└──────────────┘  └──────────────┘  └──────┬───────┘
                                          │
                                          ▼
                                 ┌──────────────┐
                                 │  进程管理     │
                                 │  (PCB、fd)   │
                                 └──────┬───────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
           ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
           │  文件系统     │    │  终端 I/O    │    │   分页       │
           │  (read/write) │    │  (stdin/out) │    │  (进程隔离)   │
           └──────────────┘    └──────────────┘    └──────────────┘
                                        │
                                        ▼
                               ┌──────────────┐
                               │  多终端      │
                               │  (3个独立)   │
                               └──────┬───────┘
                                      │
                                      ▼
                               ┌──────────────┐
                               │  PIT 调度    │
                               │  (轮转切换)   │
                               └──────────────┘
```

## 相关源文件

```
student-distrib/
├── 基础设施
│   ├── idt_init.c          # IDT 初始化
│   ├── x86_desc.h          # IDT/GDT 结构定义
│   ├── paging.c/h          # 分页实现
│   ├── interrupt_handler.S # 汇编中断处理
│   └── exception_handler.c # C 异常处理
│
├── 设备驱动
│   ├── keyboard.c/h        # 键盘驱动
│   ├── terminal.c/h        # 终端驱动
│   ├── rtc_handler.c/h     # RTC 驱动
│   └── i8259.c/h           # PIC 驱动
│
├── 文件系统
│   └── file_system.c/h     # 只读文件系统
│
├── 系统调用与进程
│   ├── syscall.h           # 系统调用号定义
│   ├── syscall_handler.c/h # 系统调用实现
│   └── global.h            # 全局定义 (PCB等)
│
└── 调度
    └── pit.c/h             # PIT 和调度器
```

## 学习建议

1. **先看概念**：理解"为什么"比"怎么做"更重要
2. **画图理解**：特别是栈变化和地址转换
3. **对照代码**：边看文档边读源码
4. **动手调试**：用 GDB 单步执行，验证理解

---

**最后更新**：2025-12-11
