# ECE 391 MP3 深度解析文档

本文档集按 Checkpoint 顺序组织，覆盖 MP3 操作系统的所有核心模块。

## 文档总览

### Checkpoint 1 - 基础设施

| 编号 | 文档 | 内容 |
|------|------|------|
| 01 | [IDT-深度解析](01-IDT-深度解析.md) | 中断描述符表、中断门/陷阱门、DPL |
| 02 | [分页系统-深度解析](02-分页系统-深度解析.md) | 页目录、页表、地址转换、CR寄存器 |
| 03 | [异常处理-深度解析](03-异常处理-深度解析.md) | 汇编包装、栈变化、pushal/iret |
| 04 | [GCC内联汇编-深度解析](04-GCC内联汇编-深度解析.md) | 内联汇编语法、约束、clobbers |
| 14 | [i8259-PIC-深度解析](14-i8259-PIC-深度解析.md) | 可编程中断控制器、ICW、EOI、中断屏蔽 |
| 17 | [x86描述符-深度解析](17-x86描述符-深度解析.md) | GDT、段描述符、TSS、特权级 |

### Checkpoint 2 - 设备驱动与文件系统

| 编号 | 文档 | 内容 |
|------|------|------|
| 05 | [键盘驱动-深度解析](05-键盘驱动-深度解析.md) | PS/2 键盘、扫描码、中断处理 |
| 06 | [终端驱动-深度解析](06-终端驱动-深度解析.md) | 终端读写、显存操作、光标控制 |
| 07 | [RTC驱动-深度解析](07-RTC驱动-深度解析.md) | RTC 硬件、频率设置、虚拟化 |
| 08 | [文件系统-深度解析](08-文件系统-深度解析.md) | 只读文件系统、inode、dentry |

### Checkpoint 3 - 系统调用与进程

| 编号 | 文档 | 内容 |
|------|------|------|
| 09 | [系统调用-深度解析](09-系统调用-深度解析.md) | int 0x80、系统调用表、文件描述符、op_table |
| 10 | [进程管理-深度解析](10-进程管理-深度解析.md) | PCB、execute、halt、进程内存布局 |
| 11 | [进程调度-深度解析](11-进程调度-深度解析.md) | 上下文切换、TSS、内核栈 |

### Checkpoint 4 - 多终端

| 编号 | 文档 | 内容 |
|------|------|------|
| 12 | [多终端-深度解析](12-多终端-深度解析.md) | Alt+Fx 切换、视频备份、键盘隔离 |

### Checkpoint 5 - 调度器

| 编号 | 文档 | 内容 |
|------|------|------|
| 13 | [PIT与调度-深度解析](13-PIT与调度-深度解析.md) | PIT 定时器、Round-Robin、schedule() |

### 附录 - 补充知识

| 编号 | 文档 | 内容 |
|------|------|------|
| 15 | [系统启动-深度解析](15-系统启动-深度解析.md) | boot.S、kernel.c、初始化顺序 |
| 16 | [工具函数库-深度解析](16-工具函数库-深度解析.md) | printf、memcpy、端口I/O、cli/sti |
| 18 | [调试技巧-深度解析](18-调试技巧-深度解析.md) | GDB、printf 调试、常见问题排查 |
| 19 | [术语表与速查表](19-术语表与速查表.md) | 术语解释、地址速查、命令速查 |

### 进阶 - Extra Credit

| 编号 | 文档 | 内容 |
|------|------|------|
| 20 | [信号处理-深度解析](20-信号处理-深度解析.md) | 信号机制、set_handler、sigreturn |
| 21 | [vidmap-深度解析](21-vidmap-深度解析.md) | 用户态显存映射、页表设置 |

### 实践 - 调试与测试

| 编号 | 文档 | 内容 |
|------|------|------|
| 22 | [常见Bug案例集](22-常见Bug案例集.md) | 各 Checkpoint 典型 Bug 及修复 |
| 23 | [测试用例编写指南](23-测试用例编写指南.md) | 测试框架、各模块测试方法 |

### 求职进阶

| 编号 | 文档 | 内容 |
|------|------|------|
| 24 | [ECE391项目面试题集](../24-ECE391项目面试题集.md) | 基于项目的面试题、简历写法、面试技巧 |
| 25 | [ECE391与Linux内核对比](../25-ECE391与Linux内核对比.md) | 与真实 Linux 内核的差异对比、过渡学习路径 |
| 26 | [项目架构总览](../26-项目架构总览.md) | 系统架构图、模块关系、执行流程图 |
| 27 | [调试实战案例集](../27-调试实战案例集.md) | 各 Checkpoint 调试案例、GDB 技巧 |
| 28 | [代码走读指南](../28-代码走读指南.md) | 源码阅读顺序、核心函数解析、调用链 |
| 29 | [练习题集](../29-练习题集.md) | 46 道练习题，覆盖所有 Checkpoint，含答案 |
| - | [Linux内核开发学习路线图](../Linux内核开发学习路线图.md) | 从 ECE391 到 Linux 内核的完整学习路径 |

## 推荐阅读顺序

### 新手入门路线

```
第一阶段: 理解基础概念
┌─────────────────────────────────────────────────────────────┐
│  15-系统启动  →  了解整体架构和初始化流程                      │
│       ↓                                                     │
│  17-x86描述符 →  理解 GDT、TSS、特权级                        │
│       ↓                                                     │
│  16-工具函数  →  熟悉常用工具 (printf, cli/sti 等)            │
└─────────────────────────────────────────────────────────────┘

第二阶段: 学习中断机制
┌─────────────────────────────────────────────────────────────┐
│  01-IDT      →  中断描述符表                                 │
│       ↓                                                     │
│  14-i8259    →  硬件中断控制器                               │
│       ↓                                                     │
│  03-异常处理  →  汇编入口和栈变化                             │
└─────────────────────────────────────────────────────────────┘

第三阶段: 学习设备驱动
┌─────────────────────────────────────────────────────────────┐
│  05-键盘驱动  →  输入设备                                    │
│       ↓                                                     │
│  06-终端驱动  →  输出设备                                    │
│       ↓                                                     │
│  07-RTC驱动   →  定时器设备                                  │
│       ↓                                                     │
│  08-文件系统  →  数据存储                                    │
└─────────────────────────────────────────────────────────────┘

第四阶段: 学习进程管理
┌─────────────────────────────────────────────────────────────┐
│  02-分页系统  →  内存管理基础                                 │
│       ↓                                                     │
│  09-系统调用  →  用户-内核接口                                │
│       ↓                                                     │
│  10-进程管理  →  PCB、execute、halt                          │
│       ↓                                                     │
│  11-进程调度  →  上下文切换                                   │
└─────────────────────────────────────────────────────────────┘

第五阶段: 学习高级功能
┌─────────────────────────────────────────────────────────────┐
│  12-多终端    →  终端隔离                                    │
│       ↓                                                     │
│  13-PIT调度   →  时间片轮转                                  │
└─────────────────────────────────────────────────────────────┘
```

### 按 Checkpoint 顺序

如果你正在做 MP3 实验，按 Checkpoint 顺序阅读：

```
CP1: 01 → 02 → 03 → 04 → 14 → 17
CP2: 05 → 06 → 07 → 08
CP3: 09 → 10 → 11
CP4: 12
CP5: 13
```

## 核心概念关联

```
                    ┌─────────────┐
                    │  系统启动    │
                    │  (boot.S)   │
                    └──────┬──────┘
                           │
         ┌─────────────────┼─────────────────┐
         │                 │                 │
         ▼                 ▼                 ▼
  ┌────────────┐    ┌────────────┐    ┌────────────┐
  │    GDT     │    │    IDT     │    │   分页     │
  │  (段描述符)  │    │  (中断入口)  │    │ (内存隔离) │
  └────────────┘    └─────┬──────┘    └────────────┘
                          │
       ┌──────────────────┼──────────────────┐
       │                  │                  │
       ▼                  ▼                  ▼
┌────────────┐    ┌────────────┐    ┌────────────┐
│  异常处理   │    │  设备中断   │    │  系统调用   │
│ (除零/页错误) │    │ (PIC管理)  │    │ (int 0x80) │
└────────────┘    └─────┬──────┘    └─────┬──────┘
                        │                 │
         ┌──────────────┼──────────────┐  │
         │              │              │  │
         ▼              ▼              ▼  ▼
  ┌────────────┐ ┌────────────┐ ┌────────────┐
  │   键盘     │ │    RTC     │ │  进程管理   │
  └────────────┘ └────────────┘ │  (PCB/fd)  │
                                └─────┬──────┘
                                      │
                 ┌────────────────────┼────────────────────┐
                 │                    │                    │
                 ▼                    ▼                    ▼
          ┌────────────┐       ┌────────────┐       ┌────────────┐
          │  文件系统   │       │   终端     │       │   调度     │
          │ (read/write)│       │(stdin/out) │       │(PIT/切换)  │
          └────────────┘       └─────┬──────┘       └────────────┘
                                     │
                                     ▼
                              ┌────────────┐
                              │   多终端    │
                              │  (3个独立)  │
                              └────────────┘
```

## 相关源文件

```
student-distrib/
├── 启动和描述符
│   ├── boot.S              # 汇编入口
│   ├── kernel.c            # C 入口
│   ├── x86_desc.S/h        # GDT/TSS 定义
│   └── lib.c/h             # 工具函数库
│
├── 中断和异常
│   ├── idt_init.c          # IDT 初始化
│   ├── interrupt_handler.S # 汇编中断处理
│   ├── exception_handler.c # C 异常处理
│   └── i8259.c/h           # PIC 驱动
│
├── 内存管理
│   └── paging.c/h          # 分页实现
│
├── 设备驱动
│   ├── keyboard.c/h        # 键盘驱动
│   ├── terminal.c/h        # 终端驱动
│   └── rtc_handler.c/h     # RTC 驱动
│
├── 文件系统
│   └── file_system.c/h     # 只读文件系统
│
├── 系统调用与进程
│   ├── syscall.h           # 系统调用号定义
│   ├── syscall_handler.c/h # 系统调用实现
│   └── global.h            # 全局定义 (PCB等)
│
└── 调度
    └── pit.c/h             # PIT 和调度器
```

## 文档特点

每个文档都包含：
- **概念解释**：为什么需要？解决什么问题？
- **数据结构**：位字段图、内存布局图
- **代码分析**：关键函数逐行解析
- **流程图**：执行流程可视化
- **使用示例**：实际代码示例
- **常见问题**：易错点和调试技巧
- **总结表格**：快速参考

## 学习建议

1. **先看概念**：理解"为什么"比"怎么做"更重要
2. **画图理解**：特别是栈变化和地址转换
3. **对照代码**：边看文档边读源码
4. **动手调试**：用 GDB 单步执行，验证理解
5. **循序渐进**：按推荐顺序学习，不要跳跃

---

**文档数量**：30 篇
**最后更新**：2025-12-15
